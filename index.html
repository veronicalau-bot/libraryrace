<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Favorite Library Spots Grand Prix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-image: url('https://m.media-amazon.com/images/I/7177+EKrnfL.jpg');
            background-color: #1a202c; /* Fallback color */
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
        }
        .racetrack {
            background-image: 
                repeating-linear-gradient(to right, #4a5568 0, #4a5568 10px, transparent 10px, transparent 20px),
                linear-gradient(to bottom, #2d3748, #1a202c);
            background-size: 100% 100%, 100% 100%;
            border-left: 5px dashed #f7fafc;
            border-right: 5px dashed #f7fafc;
        }
        .lane {
            border-bottom: 2px dashed #4a5568;
        }
        .lane:last-child {
            border-bottom: none;
        }
        .car {
            transition: transform 0.2s ease-out;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        /* --- MODIFIED CSS FOR WINNER BANNER --- */
        .winner-banner {
            /* This combines horizontal centering with vertical hiding */
            transform: translate(-50%, -250%); 
            opacity: 0;
            pointer-events: none;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s;
        }
        .winner-banner.show {
            /* This perfectly centers the banner on screen */
            transform: translate(-50%, -50%);
            opacity: 1;
            pointer-events: auto;
        }
        .like-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }
    </style>
</head>
<body class="text-white antialiased">

    <div class="min-h-screen flex flex-col items-center justify-center p-4 lg:p-8">
        <div class="w-full max-w-6xl mx-auto rounded-2xl shadow-2xl overflow-hidden">
            
            <!-- Header -->
            <header class="p-6 text-center bg-gray-900/50">
                <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400">Your Favorite Library Spots Grand Prix</h1>
                <p class="text-gray-300 mt-2">Cast your vote below!</p>
            </header>

            <!-- Spots Introduction & Voting Area -->
            <div class="p-4 md:p-8 bg-gray-900/50">
                <div id="spots-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                    <!-- Spot cards will be injected by JS -->
                </div>
            </div>

            <!-- Racetrack Area -->
            <div id="race-container" class="relative p-4 md:p-8">
                <div id="racetrack" class="w-full h-[350px] rounded-lg racetrack flex flex-col justify-around p-2 relative overflow-hidden">
                    <!-- Lanes and Cars will be injected by JS -->
                </div>
                <!-- --- MODIFIED HTML: Removed conflicting Tailwind transform classes --- -->
                <div id="winner-banner" class="winner-banner absolute top-1/2 left-1/2 bg-gradient-to-r from-yellow-400 to-orange-500 text-gray-900 font-bold text-2xl md:text-4xl p-4 md:p-6 rounded-xl shadow-lg text-center">
                    <span id="winner-text"></span> wins!
                </div>
            </div>
            
            <!-- Reset Button -->
            <footer class="p-4 text-center">
                <button id="reset-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition-all duration-300 shadow-lg">
                    Reset All Wins & Race
                </button>
            </footer>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Configuration & State ---
            const spotsData = [
                { id: 'solo-pods', name: 'Solo Pods', description: 'Best spot for focused, individual study sessions.', likes: 0, position: 0, wins: 0, color: 'bg-red-500', icon: '🚗', background: 'https://d329ms1y997xa5.cloudfront.net/accounts/206453/images/solo_pods__2_.jpg' },
                { id: 'seminar-rooms', name: 'Seminar Rooms', description: 'Perfect for group projects and discussions.', likes: 0, position: 0, wins: 0, color: 'bg-blue-500', icon: '🏎️', background: 'https://d329ms1y997xa5.cloudfront.net/accounts/206453/images/seminar_room.jpg' },
                { id: 'av-rooms', name: 'AV Rooms', description: 'Surround yourself with diverse multimedia resources.', likes: 0, position: 0, wins: 0, color: 'bg-green-500', icon: '🚁', background: 'https://d329ms1y997xa5.cloudfront.net/accounts/206453/images/AV_room.jpg' },
                { id: 'main-stack', name: 'Main Stack', description: 'Immerse youself in the endless aisles of books.', likes: 0, position: 0, wins: 0, color: 'bg-yellow-500', icon: '🚓', background: 'https://d329ms1y997xa5.cloudfront.net/accounts/206453/images/Main_stack.jpg' },
                { id: 'learning-commons', name: 'Learning Commons', description: 'A bright, open space that inspires collaboration and creativity.', likes: 0, position: 0, wins: 0, color: 'bg-purple-500', icon: '🏍️', background: 'https://d329ms1y997xa5.cloudfront.net/accounts/206453/images/Learning_commons.jpg' },
                { id: 'resources-rooms', name: 'Learning Resources Room', description: 'Dive into an environment equipped with high-end technology.', likes: 0, position: 0, wins: 0, color: 'bg-pink-500', icon: '🚙', background: 'https://d329ms1y997xa5.cloudfront.net/accounts/206453/images/IMG_3028.jpg' }
            ];

            let gameInterval = null;
            let raceOver = false;

            // --- DOM Element References ---
            const racetrack = document.getElementById('racetrack');
            const spotsGrid = document.getElementById('spots-grid');
            const winnerBanner = document.getElementById('winner-banner');
            const winnerText = document.getElementById('winner-text');
            const resetBtn = document.getElementById('reset-btn');

            // --- Functions ---

            /**
             * Initializes the game by creating UI elements and setting up listeners.
             */
            function init() {
                racetrack.innerHTML = '';
                spotsGrid.innerHTML = '';
                raceOver = false;
                winnerBanner.classList.remove('show');

                spotsData.forEach(spot => {
                    createCar(spot);
                    createSpotCard(spot);
                });

                document.querySelectorAll('.like-btn').forEach(button => {
                    button.addEventListener('click', handleLikeClick);
                });
                resetBtn.addEventListener('click', fullReset);

                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(updateRace, 100);
            }

            /**
             * Creates a car element on the racetrack.
             * @param {object} spot - The spot data object.
             */
            function createCar(spot) {
                const lane = document.createElement('div');
                lane.className = 'lane w-full h-16 flex items-center';
                lane.innerHTML = `
                    <div id="car-${spot.id}" class="car ${spot.color} w-12 h-12 rounded-full flex items-center justify-center text-2xl font-bold shadow-md" style="transform: translateX(0px);">
                        ${spot.icon}
                    </div>
                `;
                racetrack.appendChild(lane);
            }

            /**
             * Creates a voting card for a spot, now including a win counter.
             * @param {object} spot - The spot data object.
             */
            function createSpotCard(spot) {
                const card = document.createElement('div');
                const innerContent = `
                    <h3 class="text-xl font-bold text-white flex items-center">
                        ${spot.name} 
                        <div class="w-4 h-4 rounded-full ml-2 ${spot.color}"></div>
                        <span class="ml-2">${spot.icon}</span>
                    </h3>
                    <p class="text-white mt-1 flex-grow">${spot.description}</p>
                    <div class="flex items-center justify-between mt-4">
                        <button data-id="${spot.id}" class="like-btn bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg flex items-center transition-colors duration-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                            <span class="ml-2">Like</span>
                        </button>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <span id="wins-${spot.id}" class="text-2xl font-bold text-yellow-400">${spot.wins}</span>
                                <span class="text-sm text-gray-400 block">Wins</span>
                            </div>
                            <div class="text-right">
                                <span id="likes-${spot.id}" class="text-2xl font-bold text-cyan-400">${spot.likes}</span>
                                <span class="text-sm text-gray-400 block">Likes</span>
                            </div>
                        </div>
                    </div>
                `;

                if (spot.background) {
                    card.className = 'p-5 rounded-xl shadow-lg flex flex-col relative bg-cover bg-center';
                    card.style.backgroundImage = `url('${spot.background}')`;
                    card.innerHTML = `<div class="absolute inset-0 bg-black/50 rounded-xl"></div><div class="relative w-full h-full flex flex-col">${innerContent}</div>`;
                } else {
                    card.className = 'bg-gray-800 p-5 rounded-xl shadow-lg flex flex-col';
                    card.innerHTML = innerContent;
                }
                spotsGrid.appendChild(card);
            }

            /**
             * Handles the click event for the "Like" button.
             * @param {Event} event - The click event.
             */
            function handleLikeClick(event) {
                if (raceOver) return;

                const spotId = event.currentTarget.dataset.id;
                const spot = spotsData.find(s => s.id === spotId);

                if (spot) {
                    spot.likes++;
                    document.getElementById(`likes-${spot.id}`).textContent = spot.likes;
                }
            }
            
            /**
             * The main game loop to update car positions.
             * Cars will only move if they have one or more likes.
             */
            function updateRace() {
                if (raceOver) return;

                const finishLine = racetrack.clientWidth - 60;

                spotsData.forEach(spot => {
                    // **MODIFIED LOGIC**: Only move the car if it has received at least one like.
                    if (spot.likes > 0) {
                        const speed = spot.likes * 0.5 + Math.random() * 0.5;
                        spot.position += speed;

                        const carElement = document.getElementById(`car-${spot.id}`);
                        if (carElement) {
                            carElement.style.transform = `translateX(${Math.min(spot.position, finishLine)}px)`;
                        }

                        if (spot.position >= finishLine && !raceOver) {
                            endRace(spot);
                        }
                    }
                });
            }

            /**
             * Ends the race, declares a winner, updates wins, and sets a timer for auto-reset.
             * @param {object} winner - The winning spot data object.
             */
            function endRace(winner) {
                raceOver = true;
                clearInterval(gameInterval);
                
                winner.wins++;
                document.getElementById(`wins-${winner.id}`).textContent = winner.wins;

                winnerText.textContent = winner.name;
                winnerBanner.classList.add('show');

                setTimeout(resetCurrentRace, 4000); 
            }
            
            /**
             * Resets the current race (likes and positions) but keeps the win counts.
             */
            function resetCurrentRace() {
                spotsData.forEach(spot => {
                    spot.likes = 0;
                    spot.position = 0;
                });
                init();
            }

            /**
             * Resets everything including wins, for a full game restart.
             */
            function fullReset() {
                 spotsData.forEach(spot => {
                    spot.likes = 0;
                    spot.position = 0;
                    spot.wins = 0;
                });
                init();
            }

            // --- Initial Load ---
            init();
        });
    </script>
</body>
</html>
